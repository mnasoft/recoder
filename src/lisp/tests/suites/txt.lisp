;;;; ./src/tests/suites/trd.lisp

(in-package :recoder/tests)

(def-suite txt
  :description "Набор тестов, связанных с открытием текстового представления тренда."
  :in all)

(in-suite txt)

(mnas-path:asdf-path :recoder "data/txt/116-CY.txt")

(setf (r/a-sig:a-signal-print-format) :long)
(setf (r/trd:trd-print-format) :long)

(def-test txt-read-obj-write-obj ()
  (with-fixture fix-open-trd ((mnas-path:asdf-path :recoder "data/txt/116-CY.txt"))
    (mnas-bin:with-open-file-b-out (out (mnas-path:asdf-path :recoder "data/bin/116-CY.bin.trd"))
      (r/g:write-obj trd out)))
  (with-fixture fix-open-trd ((mnas-path:asdf-path :recoder "data/bin/116-CY.bin.trd"))
    (is-true (= 100 (r/c:<trd>-a-number trd)))
    (is-true (= 0 (r/c:<trd>-d-number trd)))
    (is-true
     (semi-equalp 
      (r/g:signal-value trd 0 (r/g:a-signal-list trd))
      '(0.073444843 0.099943578 0.063629448 0.090129673 0.169627368 0.137239695 0.089147687 0.09111017 -0.141527653 -0.050840378 11.58186531 -0.000793412 -0.176405907 -0.000472415 -0.001136884 -3.27826E-06 0.0 13.5892334 13.5892334 11.91518021 12.39023209 12.64931297 11.85040188 12.0231657 10.81398106 12.28224659 10.85718918 10.42534447 12.08791161 11.82883072 12.28224659 11.56971741 10.9651413 10.68445778 10.9651413 11.56971741 10.9651413 10.68445778 10.9651413 0.0 0.0 0.0 0.0 9.786399841 10.18022919 10.13004303 9.535430908 8.909362793 9.807884216 12.48023987 9.819473267 0.048744678 0 0.036966801 0 0.001478672 0.010115504 -0.004331589 -0.001662016 -0.000719786 -0.024493525 -0.000739372 0.0 0.711455941 10.06439972 21.9233551 100.9899979 315.203064 0.036692563 0.003186452 8.99285E-06 -9.55343E-05 0.034064237 26.18428802 10.53100204 11.36163044 12.01068783 11.72865868 14.23986816 15.93590355 0 0 0 0 -5.890488625 0.022011787 0.038223494 0.023446677 10.04496956 0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0)))
    (is-true
     (semi-equalp 
      (r/g:signal-value trd 99 (r/g:a-signal-list trd))
      '(0.39241761 0.293290615 0.186312199 0.195145607 0.290346146 0.206923485 0.089147687 0.09111017 24.76196098 24.94922256 12.26471329 -0.000744313 1.180362701 0.000587559 -0.000940636 0.002999961 0.0 14.44898796 14.20167065 12.30385017 13.25388813 13.08115768 12.34702492 12.84364796 11.63449574 12.73569489 11.74244881 11.24582577 12.90842628 12.26067543 13.08115768 12.1958971 11.37538242 11.56971741 11.78562355 12.1958971 11.37538242 11.56971741 11.78562355 0.0 0.0 0.0 0.0 9.859764099 10.17637634 10.13004303 9.529632568 8.909362793 9.807884216 12.48023987 9.813682556 0.033038855 0 0.036966801 0 0.001635671 0.010036945 -0.004410148 -0.001112342 2.375662327 -0.024493525 -0.004107737 0.0 0.711455941 12.45825195 21.4654007 100.9899979 267.3570557 0.122624025 0.008823943 0.002987713 -9.55343E-05 0.155810028 26.55880737 12.95335674 16.27202606 13.13880062 11.87546539 14.3866806 16.15998459 0 1027.502075 0 0 -6.273269653 0.02210208 0.038651407 0.023377975 10.05656338 0 0.0 0.0 0.0 0.0 0.0 0.0 1027.502075 1026.409058 0.0 0 )))))


(with-fixture fix-open-trd ((mnas-path:asdf-path :recoder "data/bin/116-CY.bin.trd"))
  (mapcar
   #'r/c:<a-signal>-id
   (r/g:a-signal-list trd)
   
   (length
    '("EB010" "EB020" "EB030" "EB040" "EB050" "EB060" "EB070" "EB080" "EF110"
      "EF210" "EGT" "EP010" "ANI\\EP030" "EP050" "EP110" "EP120" "ANI\\ET010"
      "ET020" "ET030" "ET040" "ET050" "ET060" "ET070" "ET080" "ET090" "ET100"
      "ET110" "ET120" "ET130" "ET140" "ET150" "ET160" "ET170" "ET180" "ET190"
      "ANI\\ET230" "ANI\\ET240" "ANI\\ET250" "ANI\\ET260" "ANI\\ET270" "ANI\\ET280"
      "ANI\\ET290" "ANI\\ET300" "ET310" "ET320" "ET330" "ET340" "ET350" "ET360"
      "ET370" "ET380" "FA010" "FA016" "FA020" "FA026" "Давление г" "FP020" "FP030"
      "FP040" "FP210" "FP220" "FP230" "FQ010" "FQ110" "FT010" "FT110" "IP210"
      "LL100" "LP010" "ANI\\LP020" "ANI\\LP110" "LP130" "ANI\\LP200" "LT010" "LT020"
      "LT030" "LT040" "LT050" "LT060" "LT070" "NHP" "NLP" "NPT" "N" "RB040" "RP010"
      "RP020" "RP030" "T1_avr" "Gfuel" "GT_Goal" "GT_Mode" "GT_Selecte" "GT_State"
      "EN210" "EN220" "EN110" "EN120" "EN310" "EN320"))
))

(+ 26 26 26 (- 26 3) )





